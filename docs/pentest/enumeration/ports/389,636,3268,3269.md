## Lightweight Directory Access Protocol (LDAP)

To retrieve naming contexts
```
ldapsearch -H ldap://<TARGET_IP> -x -s base namingcontexts
```
`-x`: Use simple authentication  
`-s`: Search scope

To retrieve all entries
```
ldapsearch -H "ldap://<TARGET_IP>" -x -b "<BASE_DN>"
ldapsearch -H "ldap://<TARGET_IP>" -x -D "<BIND_DN>" -w "<PASSWORD>" -b "<BASE_DN>"
```
`-D <BIND_DN>`: username like CN=Administrator,CN=Users,DC=example,DC=com  
`-w <PASSWORD>`: The password for the bind DN

To retrieve filtered entries
```
ldapsearch -H "ldap://<TARGET_IP>" -x -D "<BIND_DN>" -w "<PASSWORD>" -b "<BASE_DN>" "ObjectClass=<OBJECT>"

ldapsearch -H ldap://10.10.11.45 -x -D "P.Rosa@vintage.htb" -w "Rosaisbest123" -b "DC=vintage,DC=htb" "(objectClass=user)" sAMAccountName memberOf
```

Operators
```
# AND
ldapsearch <previous_options> "(&(<condition_1>)(<condition_2>)...)"
$ ldapsearch <previous_options> "(&(objectclass=account)(uid=john))"

# OR
ldapsearch <previous_options> "(|(<condition_1>)(<condition_2>)...)"
$ ldapsearch <previous_options> "(|(objectclass=account)(objectclass=organizationalRole))"

# Negation
ldapsearch <previous_options> "(!(<condition_1>)(<condition_2>)...)"
$ ldapsearch <previous_options> "(!(cn=john))"
```

```
bloodhound-python -d <DOMAIN> -u <USER> -p <PASSWORD>  -ns <TARGET_IP> -c all
bloodhound-python -d LAB.ENTERPRISE.THM -u bitbucket -p 'littleredbucket'  -ns 10.10.214.253 -c all
```

```
ldapdomaindump ldap://<DOMAIN>
ldapdomaindump ldap://dc01.vintage.htb

# Standard enumeration with credential
username='domain.tld\username'
password='password'
output_dir='./loot/ldap'
ldapdomaindump -u $username -p $password -o $output_dir dc-ip-address
```
