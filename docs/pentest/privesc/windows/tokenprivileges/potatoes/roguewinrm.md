[Rogue WinRM](https://github.com/antonioCoco/RogueWinRM) is an attack that manipulates the **Background Intelligent Transfer Service (BITS)** and **NTLM relay** to impersonate tokens, leading to SYSTEM-level privileges on the target system.
## How it works?
**Triggering BITS:**  
- The attacker uses the `CoCreateInstance()` function to trigger the BITS service. This function causes BITS to communicate with the **legitimate Windows Remote Management (WinRM) service** on port 5985, attempting to authenticate.  
**NTLM Relay Setup:**  
- Instead of allowing BITS to communicate directly with the real WinRM service, the attacker sets up a **rogue WinRM server** to intercept the NTLM authentication process.  
- **NTLM Type 1 message**: When BITS initiates authentication, it sends an NTLM Type 1 message (authentication request) to the rogue server.  
**Relaying NTLM Messages:**  
- The rogue WinRM server **relays** the Type 1 message to the **real WinRM server** on port 5985.
- The **real WinRM server** responds with an **NTLM Type 2 message** (challenge), which is relayed back to BITS by the rogue server.  
**NTLM Type 3 (Final Authentication):**    
- BITS generates an **NTLM Type 3 message**, which contains the authentication response.  
- This message allows the attacker to **impersonate the SYSTEM account** by capturing the NTLM Type 3 message, which can be manipulated to gain access to the SYSTEM token.  
**Impersonation and Privilege Escalation:**  
- The attacker uses the `QuerySecurityContextToken()` function to extract the **SYSTEM token** from the NTLM Type 3 message.  
- With this token, they can **impersonate the SYSTEM account**, allowing them to run commands or processes with **SYSTEM privileges**.  
**Process Creation:**  
- The attacker then calls `CreateProcessWithTokenW()`, which allows them to create a new process (such as a command prompt) under the SYSTEM account, effectively gaining full control over the machine.
