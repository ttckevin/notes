It primarily targets the way named pipes and RPC (Remote Procedure Call) notifications are handled by the Print Spooler, specifically leveraging the **Printer Bug** exploit.
## How it works?
The concept behind [PrintSpoofer](https://github.com/itm4n/PrintSpoofer) is leveraging the **Printer Bug** exploit, which abuses the Windows Print Spooler service’s `RpcRemoteFindFirstPrinterChangeNotificationEx` function. This function sends change notifications via RPC over Named Pipes to a specific named pipe, typically `\\HOSTNAME\pipe\spoolss`, which is owned and controlled by the SYSTEM account. Since creating or controlling this specific pipe directly isn't feasible due to its ownership, a clever manipulation of the path can bypass this restriction.

 Core steps in PrintSpoofer:  
1. **Named Pipe Creation**: PrintSpoofer first creates a **Named Pipe** using `CreateNamedPipe()` and sets permissions to allow **Everyone** access.  
2. **Waiting for Connection**: Using `ConnectNamedPipe()`, the process pauses, waiting for a client (the Print Spooler service running as SYSTEM) to connect.  
3. **Impersonation**: Once the SYSTEM process connects, `ImpersonateNamedPipeClient()` is called, allowing PrintSpoofer to impersonate SYSTEM and execute code in its context.

To Bypassing Path Restrictions:

The Printer Bug by default sends notifications to `\\HOSTNAME\pipe\spoolss`, but this path is protected. The key trick, discovered by Jonas Lykkegaard, involves manipulating the hostname string. By including a `/` in the hostname (e.g., `\\HOSTNAME/pipe/foo123`), it passes path validation checks, and Windows' internal path normalization converts the `/` into `\`, transforming the path into a valid named pipe like `\\HOSTNAME\pipe\foo123\pipe\spoolss`.  
Steps of Exploit:  
1. **Path Manipulation**: The crafted path allows the attacker to control the pipe used by the Print Spooler service to send notifications.  
2. **Connection to Controlled Pipe**: The Print Spooler service, running as SYSTEM, connects to the attacker-controlled named pipe (e.g., `\\HOSTNAME\pipe\foo123\pipe\spoolss`).  
3. **Token Capture and Impersonation**: Once connected, the SYSTEM token is captured, and the attacker can impersonate SYSTEM using `ImpersonateNamedPipeClient()`.

Note: `PrintSpoofer` does not work under `NT AUTHORITY\SERVICE`. It **requires** the user to be running as `LOCAL SERVICE` or `NETWORK SERVICE`, with `SeImpersonatePrivilege`

## Printer Bug
It exploits a vulnerability in the **MS-RPRN (Microsoft Remote Print)** RPC interface, which is responsible for handling printer-related requests in Windows. The main goal of the **Printer Bug** is to **coerce a Windows machine** (such as a **Domain Controller**) into **authenticating to another system**, creating opportunities for **credential theft** and **privilege escalation** in an Active Directory environment.
### How the Printer Bug Works?
1. **MS-RPRN RPC Interface**:
- The MS-RPRN interface allows users to interact with remote print servers.
- The vulnerability comes from how print requests can be manipulated to force a machine (like a Domain Controller) to **authenticate to a remote system**.
2. **Coercing Authentication**:
- By exploiting this bug, the attacker uses the MS-RPRN interface to trick a **Domain Controller** or other systems into connecting back to a server they control.
- When this happens, the target machine sends **authentication credentials**, typically via **NTLM**.
3. **Unconstrained Delegation**:
- If the attacker’s machine is configured with **unconstrained delegation**, it can then **capture** and **relay** these credentials to gain access to the compromised system or escalate privileges.
- This method is particularly powerful in **multi-forest environments** or **two-way trusts**, where the attacker can pivot between domains or forests by forcing systems to authenticate with their server.
