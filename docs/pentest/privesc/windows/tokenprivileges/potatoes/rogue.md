[Rogue Potato](https://github.com/antonioCoco/RoguePotato) is an exploit that enables privilege escalation to SYSTEM on Windows machines by leveraging DCOM and RPC mechanisms, specifically by manipulating OXID resolution requests.

Post-Patch fixes for Juicy Potato (Background information):  
- Impossible to specify a custom port for the OXID resolver. Only port 135 can be used for these requests.
- You can redirect OXID resolution requests to a **remote server** that you control, still using port 135. However, this will only yield an **ANONYMOUS LOGON** (Limited privilege).  
- By forwarding the OXID resolution requests to a **local Fake RPC server**, you can obtain an **identification token** during the `IRemUnknown2` interface query. However, it's essential to understand that these tokens are **not useful for impersonation purposes**.

## How it works? 
1. **Protocol Exploitation via Named Pipes**: The Rogue Potato exploit focuses on manipulating protocols supported by RPC, such as `ncacn_ip_tcp`, `ncacn_np`, and a key named pipe: `epmapper`, which operates in the same process space as the RPCSS service. Initially, when testing with the pipe `ncacn_np:localhost[\pipe\roguepotato]`, the RPCSS service still attempted to connect to the reserved `\pipe\epmapper` due to protocol design limitations.

2. **Named Pipe Validation Bypass**: Inspired by the PrintSpoofer technique (credit to @itm4n and @jonasLyk), a clever bypass was implemented. By injecting a `/` in the hostname (`ncacn_np:localhost/pipe/roguepotato[\pipe\epmapper]`), the RPCSS service was tricked into connecting to a non-existent pipe `\roguepotato\pipe\epmapper`. A pipe listener was then set up on `\\.\pipe\roguepotato\pipe\epmapper`, allowing the attacker to intercept the connection, impersonate the RPCSS client, and obtain an impersonation token for the NETWORK SERVICE account.

3. **Token Duplication and Privilege Escalation**: Once the impersonation token of NETWORK SERVICE and the LUID of the RPCSS service are obtained, further steps involve:
- **Identify the RPCSS Process**: Get the Process ID (PID) of the `rpcss` service.
- **Enumerate Handles**: Open the `rpcss` process and list all its handles.
- **Duplicate Token Handles**: For each handle, attempt to duplicate it and determine the handle type.
- **Check for SYSTEM Token**: If the handle type is "Token" and its owner is SYSTEM, the token is duplicated and leveraged for privilege escalation.

4. **Launch SYSTEM-level Processes**: With the SYSTEM token in hand, processes can be launched using `CreateProcessAsUser()` or `CreateProcessWithToken()`.
- **Session 0 Access Issues**: To bypass occasional "Access Denied" errors when launching processes in Session 0, correct permissions must be set on the Windows Station/Desktop to ensure processes are executed successfully with SYSTEM privileges.

## Summary
The **Rogue Potato** exploit is based on manipulating how the **OXID Resolver** and **RPC services** handle object resolution and inter-process communication. Specifically, the attacker targets the **RPCSS service**, which relies on named pipes like `epmapper` for resolving network objects. By cleverly modifying how these services are called and interacted with, the attacker redirects the connection through a crafted pipe name (e.g., using the `/` trick) to control where RPCSS connects.

Instead of allowing RPCSS to communicate with the legitimate `\pipe\epmapper`, the exploit tricks it into connecting to `\roguepotato\pipe\epmapper`, where the attacker has set up a listener. This allows the attacker to capture the interaction and impersonate the **NETWORK SERVICE** account, obtaining an impersonation token.

With access to this token, the attacker then escalates privileges by locating and duplicating a **SYSTEM token** from the RPCSS service. Using this SYSTEM token, they can launch processes with **SYSTEM-level privileges** and effectively gain full control of the system.

In short, it's a combination of **service manipulation**, **response redirection**, and **impersonation** to achieve SYSTEM-level access.
